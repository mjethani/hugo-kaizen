/* Copyright (c) 2025 Manish Jethani */

@layer {
  @layer tokens {
    :root {
      --accent-color: auto;
      --active-link-text-decoration-style: double;
      --background-color: #fdfdfd;
      --bold-font-weight: 600;
      --code-font-family: monospace;
      --color: #111;
      --font-family: serif;
      --font-size: 1rem;
      --font-weight: 400;
      --footer-font-family: var(--font-family);
      --heading-line-height: 1.272;
      --line-height: 1.618;
      --link-color: var(--color);
      --link-text-decoration-style: solid;
      --link-text-underline-offset: 0.382em;
      --max-inline-size: 30rem;
      --nav-font-family: var(--font-family);
      --title-color: var(--color);
      --title-font-family: var(--font-family);
      --title-font-size: 1.272rem;
      --title-font-weight: 500;
      --title-letter-spacing: 0.236rem;
      --title-text-transform: uppercase;
      --writing-mode: horizontal-tb;
    }
  }

  @layer base {
    *, ::before, ::after {
      box-sizing: border-box;
    }

    :root {
      accent-color: var(--accent-color);
      color-scheme: light dark;
      font-family: var(--font-family);
      font-size: var(--font-size);
      writing-mode: var(--writing-mode);
    }

    body {
      background-color: var(--background-color);
      color: var(--color);
      font-weight: var(--font-weight);
      line-height: var(--line-height);
    }
  }

  @layer typography {
    body > footer {
      font-family: var(--footer-font-family);
    }

    nav {
      font-family: var(--nav-font-family);
    }

    a {
      color: var(--link-color);
      text-decoration: underline;
      text-decoration-style: var(--link-text-decoration-style);
      text-underline-offset: var(--link-text-underline-offset);
    }

    a.active {
      text-decoration-style: var(--active-link-text-decoration-style);
    }

    b, strong {
      font-weight: var(--bold-font-weight);
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: var(--bold-font-weight);
      line-height: var(--heading-line-height);
      margin: 0;
      margin-block-end: 1rem;
      margin-block-start: 1.618rem;
    }

    h1 {
      font-size: 2.058rem;
    }

    h2 {
      font-size: 1.618rem;
    }

    h3 {
      font-size: 1.272rem;
    }

    h4, h5, h6 {
      font-size: 1rem;
    }

    p {
      margin: 0;
      margin-block-end: 1rem;
    }

    ul, ol {
      margin: 0;
      margin-block-end: 1rem;
      margin-inline-start: 1.618rem;
      padding: 0;
    }

    li + li {
      margin-block-start: 0.382rem;
    }

    main > section > ul,
    main > aside > ul {
      list-style: none;
      margin-inline-start: 0;
    }

    main > section > ul > li:dir(ltr) {
      list-style-type: '→  ';
    }
    main > section > ul > li:dir(rtl) {
      list-style-type: '  ←';
    }

    .taxonomy-kind main > section > ul > li:dir(ltr) {
      list-style-type: '⧉  ';
    }
    .taxonomy-kind main > section > ul > li:dir(rtl) {
      list-style-type: '  ⧉';
    }

    pre {
      background-color: color-mix(in srgb, var(--color) 5.6%, transparent);
      border-radius: 0.486rem;
      font-size: 0.786rem;
      margin: 0;
      margin-block: 1.618rem;
      padding: 0.618rem;
      white-space: pre-wrap;
      word-break: break-word;
    }

    pre:has(> code:only-child) {
      direction: ltr;
      text-align: start;
    }

    code {
      font-family: var(--code-font-family);
    }

    :not(pre) > code {
      font-size: 0.786rem;
    }

    img {
      display: block;
      block-size: auto;
      inline-size: auto;
      margin: 0;
      margin-block: 1.618rem;
      max-inline-size: 100%;
    }

    figure {
      display: flex;
      flex-direction: column;
      gap: 0.618rem;
      margin: 0;
      margin-block: 1.618rem;
    }

    figure > * {
      margin: 0;
    }

    figure > figcaption {
      font-size: 0.786rem;
    }

    blockquote {
      border-inline-start: 0.115rem solid color-mix(in srgb, var(--color) 11.5%, transparent);
      color: color-mix(in srgb, var(--color) 78.6%, transparent);
      margin: 0;
      margin-block: 1.618rem;
      padding: 0;
      padding-inline-start: 1rem;
    }

    blockquote > footer {
      font-size: 0.786rem;
    }

    blockquote > footer > cite:only-child {
      display: flex;
      font-style: normal;
    }

    blockquote > footer > cite:only-child::before {
      content: '―';
      margin-inline-end: 0.236rem;
    }

    table {
      border-collapse: collapse;
      font-variant-numeric: tabular-nums;
      inline-size: 100%;
      margin: 0;
      margin-block: 1.618rem;
    }

    caption {
      caption-side: block-end;
      color: color-mix(in srgb, var(--color) 61.8%, transparent);
      font-size: 0.786rem;
      padding-block-start: 0.486rem;
    }

    thead th {
      background-color: color-mix(in srgb, var(--color) 14.6%, transparent);
      text-align: start;
    }

    th, td {
      border-block-end: 0.071rem solid color-mix(in srgb, var(--color) 18.6%, transparent);
      padding-block: 0.486rem;
      padding-inline: 0.618rem;
      vertical-align: top;
    }

    th {
      font-weight: var(--bold-font-weight);
    }

    tbody tr:nth-child(odd) {
      background-color: color-mix(in srgb, var(--color) 5.6%, transparent);
    }

    tbody tr:hover {
      background-color: color-mix(in srgb, var(--color) 11.5%, transparent);
    }

    th[scope=row] {
      text-align: start;
    }

    td > :first-child, th > :first-child {
      margin-block-start: 0;
    }

    td > :last-child, th > :last-child  {
      margin-block-end: 0;
    }
  }

  @layer layout {
    body {
      align-items: center;
      display: flex;
      flex-direction: column;
      margin: 0;
      margin-inline: 1.618rem;
    }

    body > * {
      inline-size: 100%;
      max-inline-size: var(--max-inline-size);
    }

    body > header {
      display: flex;
      flex-direction: column;
      gap: 2.058rem;
      margin-block-end: 2.058rem;
      margin-block-start: 1rem;
    }

    body > footer {
      display: flex;
      flex-direction: column;
      gap: 0.618rem;
      margin-block-end: 1rem;
      margin-block-start: 2.058rem;
    }

    /* min-inline-size is not supported inside media queries yet. */
    @media (min-width: 30rem) {
      body > footer {
        flex-direction: row;
      }

      body > footer > * {
        flex: 1;
      }
    }

    .menu {
      order: -1;
    }

    main > :first-child {
      margin-trim: block-start;
    }

    main > :last-child {
      margin-trim: block-end;
    }

    main > :only-child {
      margin-trim: block;
    }

    @supports not (margin-trim: block) {
      main > :first-child > :first-child,
      main > :first-child > :first-child > :first-child,
      main > :first-child > :first-child > :first-child > :first-child {
        margin-block-start: 0;
      }

      main > :last-child > :last-child,
      main > :last-child > :last-child > :last-child,
      main > :last-child > :last-child > :last-child > :last-child {
        margin-block-end: 0;
      }
    }

    main > article > header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
  }

  @layer components {
    .copyright, .powered-by {
      font-size: 0.786rem;
      font-weight: 300;
      margin: 0;
      text-align: center;
    }

    .powered-by a {
      font-weight: 600;
    }

    .title {
      color: var(--title-color);
      font-family: var(--title-font-family);
      font-size: var(--title-font-size);
      font-weight: var(--title-font-weight);
      inline-size: 100%;
      letter-spacing: var(--title-letter-spacing);
      margin: 0;
      text-transform: var(--title-text-transform);
    }

    html:not(.home-kind) .title {
      font-size: calc(var(--title-font-size) * 0.618);
    }

    .menu nav ul {
      display: flex;
      flex-wrap: wrap;
      font-weight: 300;
      font-size: 0.786rem;
      gap: 1.618rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .menu nav ul > li {
      margin: 0;
      padding: 0;
    }

    .menu nav ul > li:has(> a[href^='/'])::before {
      content: '⟨ ';
    }

    .menu nav ul > li:has(> a[href^='/'])::after {
      content: ' ⟩';
    }

    .menu nav ul > li:not(:has(> a[href^='/']))::before {
      content: '⟪ ';
    }

    .menu nav ul > li:not(:has(> a[href^='/']))::after {
      content: ' ⟫';
    }

    .article-title {
      font-size: 2.618rem;
      font-weight: 500;
      margin: 0;
    }

    .article-date {
      display: block;
      font-size: 0.786rem;
      font-weight: 300;
      margin: 0;
    }

    .article-translations {
      font-size: 0.786rem;
      font-weight: 300;
    }

    .article-translations ul {
      display: flex;
      flex-wrap: wrap;
      gap: 0.618rem 1.618rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .article-translations ul > li {
      margin: 0;
      padding: 0;
    }

    .article-translations ul > li:dir(ltr) {
      list-style-type: '∼  ';
    }
    .article-translations ul > li:dir(rtl) {
      list-style-type: '  ∽';
    }

    .article-content {
      margin-trim: block;
      margin-block: 2.058rem;
    }

    @supports not (margin-trim: block) {
      .article-content > :first-child,
      .article-content > :first-child > :first-child,
      .article-content > :first-child > :first-child > :first-child {
        margin-block-start: 0;
      }

      .article-content > :last-child,
      .article-content > :last-child > :last-child,
      .article-content > :last-child > :last-child > :last-child {
        margin-block-end: 0;
      }
    }

    .article-tags > div > div {
      display: none;
    }

    .article-tags ul {
      display: flex;
      flex-wrap: wrap;
      gap: 0.618rem 1rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .article-tags ul > li {
      display: inline-flex;
      margin: 0;
      padding: 0;
    }

    .article-tags ul > li a::before {
      content: '#';
    }

    .related {
      margin-block-start: 2.058rem;
    }

    .related > ul > li:dir(ltr) {
      list-style-type: '≅  ';
    }
    .related > ul > li:dir(rtl) {
      list-style-type: '  ≅';
    }

    #search-label {
      position: relative;
    }

    #search-icon {
      block-size: 1rem;
      inline-size: 1rem;
      inset-block-start: 0.5rem;
      inset-inline-start: 0.3rem;
      pointer-events: none;
      position: absolute;
    }

    #search-input {
      background-color: transparent;
      block-size: 2rem;
      border: 0.056rem solid color-mix(in srgb, var(--color) 18.6%, transparent);
      border-radius: 0.236rem;
      box-shadow: var(--color) 0 0 0.09rem;
      color: var(--color);
      display: block;
      font-size: 1rem;
      inline-size: 100%;
      margin-block: 1.618rem;
      margin-inline: 0;
      max-inline-size: 20rem;
      padding-block: 0.186rem;
      padding-inline-end: 0.3rem;
      padding-inline-start: 1.6rem;
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    #search-input:focus {
      background-color: color-mix(in srgb, var(--color) 5.6%, transparent);
      border-color: color-mix(in srgb, var(--color) 30%, transparent);
      outline: none;
    }

    #search-input::-webkit-search-cancel-button {
      -webkit-appearance: none;
      display: none;
    }

    #search-results {
      min-block-size: 20rem;
    }

    #search-results .query {
      font-weight: 600;
    }

    #search-results ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #search-results ul > li:dir(ltr) {
      list-style-type: '◎  ';
    }
    #search-results ul > li:dir(rtl) {
      list-style-type: '  ◎';
    }
  }

  @layer utilities {
    .num {
      text-align: end;
    }

    .nowrap {
      white-space: nowrap;
    }
  }
}
