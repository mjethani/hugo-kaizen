/* Copyright (c) 2025 Manish Jethani */

@layer {
  /* Hugo doesn't minify CSS inside layers.
   *
   * This has now been addressed in the parser:
   * https://github.com/tdewolff/parse/pull/126
   * The fix should be included in v0.148.3:
   * https://github.com/gohugoio/hugo/commit/885cd299b78dba363f37f279f4de05d074b3c3d4
   */
  @layer tokens {
    :root {
      --background-color: #fdfdfd;
      --color: #111;
      --font-family: Palatino, 'Palatino Linotype', 'Book Antiqua', 'Noto Serif', 'DejaVu Serif', serif;
      --font-size: 1rem;
      --font-weight: 400;
      --max-inline-size: 30rem;
      --writing-mode: horizontal-tb;
    }
  }

  @layer base {
    *, ::before, ::after {
      box-sizing: border-box;
    }

    :root {
      font-family: var(--font-family);
      font-size: var(--font-size);
      font-weight: var(--font-weight);
      writing-mode: var(--writing-mode);
    }

    body {
      background-color: var(--background-color);
      color: var(--color);
    }
  }

  @layer typography {
    body {
      line-height: 1.618;
    }

    a {
      color: var(--color);
      text-decoration: underline;
      text-decoration-style: dotted;
      text-underline-offset: 0.236em;
    }

    strong {
      font-weight: 600;
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.272;
      margin: 0;
      margin-block-end: 1rem;
      margin-block-start: 1.618rem;
    }

    h1 {
      font-size: 2.058rem;
    }

    h2 {
      font-size: 1.618rem;
    }

    h3 {
      font-size: 1.272rem;
    }

    h4, h5, h6 {
      font-size: 1rem;
    }

    p {
      margin: 0;
      margin-block-end: 1rem;
    }

    ul, ol {
      margin: 0;
      margin-block-end: 1rem;
      margin-inline-start: 1.618rem;
      padding: 0;
    }

    li + li {
      margin-block-start: 0.382rem;
    }

    main > section > ul,
    main > aside > ul {
      list-style: none;
      margin-inline-start: 0;
    }

    main > section > ul > li:dir(ltr) {
      list-style-type: '→  ';
    }
    main > section > ul > li:dir(rtl) {
      list-style-type: '  ←';
    }

    pre {
      border-radius: 0.486rem;
      font-size: 0.786rem;
      margin: 0;
      margin-block: 1.618rem;
      padding: 0.618rem;
      white-space: pre-wrap;
      word-break: break-word;
    }

    pre:has(> code:only-child) {
      direction: ltr;
      text-align: start;
    }

    :not(pre) > code {
      font-size: 0.786rem;
    }

    img {
      display: block;
      block-size: auto;
      inline-size: auto;
      margin: 0;
      margin-block: 1.618rem;
      max-inline-size: 100%;
    }

    figure {
      display: flex;
      flex-direction: column;
      gap: 0.618rem;
      margin: 0;
      margin-block: 1.618rem;
    }

    figure > * {
      margin: 0;
    }

    figure > figcaption {
      font-size: 0.786rem;
    }

    blockquote {
      border-inline-start: 0.115rem solid color-mix(in srgb, var(--color) 11.5%, transparent);
      color: color-mix(in srgb, var(--color) 78.6%, transparent);
      margin: 0;
      margin-block: 1.618rem;
      padding: 0;
      padding-inline-start: 1rem;
    }

    blockquote > footer {
      font-size: 0.786rem;
    }

    blockquote > footer > cite:only-child {
      display: flex;
      font-style: normal;
    }

    blockquote > footer > cite:only-child::before {
      content: '―';
      margin-inline-end: 0.236rem;
    }

    table {
      border-collapse: collapse;
      font-variant-numeric: tabular-nums;
      inline-size: 100%;
      margin: 0;
      margin-block: 1.618rem;
    }

    caption {
      caption-side: block-end;
      color: color-mix(in srgb, var(--color) 61.8%, transparent);
      font-size: 0.786rem;
      padding-block-start: 0.486rem;
    }

    thead th {
      background-color: color-mix(in srgb, var(--color) 14.6%, transparent);
      text-align: start;
    }

    th, td {
      border-block-end: 0.071rem solid color-mix(in srgb, var(--color) 18.6%, transparent);
      padding-block: 0.486rem;
      padding-inline: 0.618rem;
      vertical-align: top;
    }

    th {
      font-weight: 600;
    }

    tbody tr:nth-child(odd) {
      background-color: color-mix(in srgb, var(--color) 5.6%, transparent);
    }

    tbody tr:hover {
      background-color: color-mix(in srgb, var(--color) 11.5%, transparent);
    }

    th[scope=row] {
      text-align: start;
    }

    td > :first-child, th > :first-child {
      margin-block-start: 0;
    }

    td > :last-child, th > :last-child  {
      margin-block-end: 0;
    }
  }

  @layer layout {
    body {
      align-items: center;
      display: flex;
      flex-direction: column;
      margin: 0;
      margin-inline: 1.618rem;
    }

    body > * {
      inline-size: 100%;
      max-inline-size: var(--max-inline-size);
    }

    body > header {
      display: flex;
      flex-direction: column;
      gap: 2.058rem;
      margin-block-end: 2.058rem;
      margin-block-start: 1rem;
    }

    body > footer {
      display: flex;
      flex-direction: column;
      gap: 0.618rem;
      margin-block-end: 1rem;
      margin-block-start: 1.618rem;
    }

    .menu {
      order: -1;
    }

    main > :first-child {
      margin-trim: block-start;
    }

    main > :last-child {
      margin-trim: block-end;
    }

    main > :only-child {
      margin-trim: block;
    }

    @supports not (margin-trim: block) {
      main > :first-child > :first-child,
      main > :first-child > :first-child > :first-child,
      main > :first-child > :first-child > :first-child > :first-child {
        margin-block-start: 0;
      }

      main > :last-child > :last-child,
      main > :last-child > :last-child > :last-child,
      main > :last-child > :last-child > :last-child > :last-child {
        margin-block-end: 0;
      }
    }

    main > article > header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
  }

  @layer components {
    .copyright, .powered-by {
      font-size: 0.786rem;
      font-weight: 300;
      margin: 0;
      text-align: center;
    }

    .powered-by a {
      font-weight: 600;
    }

    .title {
      font-size: 1.272rem;
      font-weight: 500;
      inline-size: 100%;
      line-height: 1;
      margin: 0;
      text-transform: uppercase;
    }

    /* Latin */
    .title:lang(en), .title:lang(es), .title:lang(pt),
    .title:lang(fr), .title:lang(de), .title:lang(id),
    .title:lang(it), .title:lang(pl), .title:lang(nl),
    .title:lang(ro), .title:lang(vi), .title:lang(tr),
    .title:lang(sw), .title:lang(hu), .title:lang(cs),
    .title:lang(sk), .title:lang(sr), .title:lang(hr),
    .title:lang(fi), .title:lang(no), .title:lang(da),
    .title:lang(sv), .title:lang(af), .title:lang(ms),
    .title:lang(lb), .title:lang(et), .title:lang(sl),
    .title:lang(is), .title:lang(mt), .title:lang(gd),
    .title:lang(lt), .title:lang(ga), .title:lang(bs),
    .title:lang(zu), .title:lang(xh), .title:lang(st),
    .title:lang(nso), .title:lang(rw), .title:lang(tl),
    .title:lang(ceb), .title:lang(jv), .title:lang(hmn),
    .title:lang(mg), .title:lang(mn) {
      letter-spacing: 0.236rem;
    }

    html:not(.home-kind) .title {
      font-size: 0.786rem;
    }

    .menu nav ul {
      display: flex;
      flex-wrap: wrap;
      font-weight: 300;
      font-size: 0.786rem;
      gap: 1.618rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .menu nav ul > li {
      line-height: 1;
      margin: 0;
      padding: 0;
    }

    .menu nav ul > li:has(> a[href^='/'])::before {
      content: '⟨ ';
    }

    .menu nav ul > li:has(> a[href^='/'])::after {
      content: ' ⟩';
    }

    .menu nav ul > li:not(:has(> a[href^='/']))::before {
      content: '⟪ ';
    }

    .menu nav ul > li:not(:has(> a[href^='/']))::after {
      content: ' ⟫';
    }

    .article-title {
      font-size: 2.618rem;
      font-weight: 500;
      margin: 0;
    }

    .article-date {
      display: block;
      font-size: 0.786rem;
      font-weight: 300;
      margin: 0;
    }

    .article-content {
      margin-trim: block;
      margin-block-start: 2.058rem;
      margin-block-end: 1.618rem;
    }

    @supports not (margin-trim: block) {
      .article-content > :first-child,
      .article-content > :first-child > :first-child,
      .article-content > :first-child > :first-child > :first-child {
        margin-block-start: 0;
      }

      .article-content > :last-child,
      .article-content > :last-child > :last-child,
      .article-content > :last-child > :last-child > :last-child {
        margin-block-end: 0;
      }
    }

    .article-tags > div > div {
      display: none;
    }

    .article-tags ul {
      color: color-mix(in srgb, var(--color) 78.6%, transparent);
      display: flex;
      flex-wrap: wrap;
      gap: 0.618rem 1rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .article-tags ul > li {
      display: inline-flex;
      line-height: 1;
      margin: 0;
      padding: 0;
    }

    .article-tags ul > li a::before {
      content: '#';
    }

    .related {
      margin-block-start: 2.058rem;
    }

    .related > ul > li:dir(ltr) {
      list-style-type: '≅  ';
    }
    .related > ul > li:dir(rtl) {
      list-style-type: '  ≅';
    }
  }

  @layer utilities {
    .num {
      text-align: start;
    }

    .nowrap {
      white-space: nowrap;
    }
  }

  @layer theme {
    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #1c1b1a;
        --color: #e8e6e3;
      }
    }

    pre {
      background-color: #272822;
      color: #f8f8f2;
    }

    @media (prefers-color-scheme: dark) {
      pre {
        background-color: #282828;
        color: #ebdbb2;
      }
    }
  }
}
